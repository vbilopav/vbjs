define(["sys/view-manager/utils","sys/app","sys/view-manager/components"],(e,t,{getEntry:n})=>{const a=(e,t,a)=>{if(!t.includes(e.nodeName))return;const r=n(e.nodeName);if(!r)return;found=!0;const s={},i=r.wrap.createElement();for(let t=0,n=e.attributes.length;t<n;t++){let n=e.attributes[t];s[n.name.toCamelCase()]=n.value,i.setAttribute(n.name,n.value)}if(s.html=e.html(),e.parentElement.insertBefore(i,e),e.remove(),a){s.___owner=a;let e=s.name||s.id;e&&((a=a.template||a).children=a.children||{},a.children[e.toCamelCase()]=s)}return new MutationObserver(e=>{s.template;for(let t of e){if(!t.attributeName)continue;const e=t.attributeName.toCamelCase(),n=t.target.getAttribute(t.attributeName);s.template&&(!s.template[e]||s.template[e](n)),s.__instance&&(s.__instance[e]=n)}}).observe(i,{attributes:!0,childList:!1,subtree:!1}),{view:r.src,elementOrId:i,params:s}},r=(e,t,n)=>{let r=t.components;if(!r||!r.length)return;const i=[];e.forEachChild(e=>{let t=a(e,r,n);t&&i.push(t)});const o=new MutationObserver(e=>{for(let t of e)if(t.addedNodes&&t.addedNodes.length)for(let e of t.addedNodes){let t=a(e,r,n);o.takeRecords(),t&&s(t)}}),l={attributes:!1,childList:!0,subtree:!0};return i.length?Promise.all(i.map(e=>s(e))).then(t=>{o.observe(e,l)}):o.observe(e,l),o},s=({id:n="",view:a=(()=>{throw a})(),params:s={},uri:i="",elementOrId:o=(()=>{throw o})()})=>new Promise(l=>{let m,c;if("string"==typeof a?(m=a,c=[a]):"object"==typeof a&&(m=a.name,c=a.inject?[m].concat(a.inject):[m]),!m||!c)throw new Error("View definition incorrect!");require(c,(a,...c)=>{const p=i.hashCode(),d=e.getViewType(a,m),f="string"==typeof o?"span".createElement(o):o,u={type:d,uriHash:p,x:0,y:0,id:n};n&&(f.dataset.id=n);const h=()=>{const n=n=>{"function"==typeof n||n instanceof Array?(n=t.parse(...n)).then(t=>{"string"==typeof t?f.html(t):f.html("").append(t),r(f,u.instance._options,u.instance),e.moduleRendered(u.instance,{params:s,element:f})}):("string"==typeof n||n instanceof HTMLElement)&&("string"==typeof n?f.html(n):f.html("").append(n),r(f,u.instance._options,u.instance),e.moduleRendered(u.instance,{params:s,element:f}))};if(d===e.types.class){let e=u.instance.render({params:s,element:f});return("function"==typeof e||e instanceof Array)&&(e="function"==typeof e?t.parse(e):t.parse(...e)),e instanceof Promise?e.then(e=>(n(e),l({data:u,element:f}))):(n(e),l({data:u,element:f}))}return l({data:u,element:f})};if(d===e.types.string)return u.element=f.html(a),h();if(d===e.types.template){u.instance=a;let t=a(s,{injected:c});return"string"==typeof t?(f.html(t),r(f,s.template,s),e.templateRendered(s,f)):t instanceof HTMLElement?(f.html("").append(t),r(f,s.template,s),e.templateRendered(s,f)):t instanceof Promise&&t.then(t=>{"string"==typeof t?f.html(t):f.html("").append(t),r(f,s.template,s),e.templateRendered(s,f)}),h()}if(d===e.types.class){const t={disableCaching:!1,callRenderOnlyOnce:!1,css:[]};if(e.prepareInstance(t),u.instance=new a({id:n,element:f,options:t},...c),u.instance._options=t,s.__instance=u.instance,s.___owner&&(u.instance.parent=s.___owner,delete s.___owner),!t.css||!t.css.length)return h();require(t.css.map(e=>e.startsWith("text!")?e:"text!"+e),(...e)=>(document.head.appendChild(`<style type="text/css">\n                                    ${e.join("")}\n                                </style>`.toHTML()),h()))}})});return{reveal:s,revealComponents:r}});