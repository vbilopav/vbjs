define(["sys/view-manager/utils","sys/app"],(e,t)=>({id:n="",view:r=(()=>{throw r})(),params:i={},uri:a="",elementOrId:s=(()=>{throw s})()})=>new Promise(p=>{let l,o;if("string"==typeof r?(l=r,o=[r]):"object"==typeof r&&(l=r.name,o=r.inject?[l].concat(r.inject):[l]),!l||!o)throw new Error("View definition incorrect!");require(o,(r,...o)=>{let d=a.hashCode(),c=e.getViewType(r,l),m="string"==typeof s?"span".createElement(s):s,f={type:c,uriHash:d,x:0,y:0,id:n};if(n&&(m.dataset.id=n),c===e.types.string)f.element=m.html(r);else if(c===e.types.template){f.instance=r;let e=r(i,{injected:o});"string"==typeof e?(m.html(e),i.___rendered(m)):e instanceof HTMLElement?(m.html("").append(e),i.___rendered(m)):e instanceof Promise&&e.then(e=>{"string"==typeof e?m.html(e):m.html("").append(e),i.___rendered(m)})}else if(c===e.types.class){let e={disableCaching:!1,callRenderOnlyOnce:!1};f.instance=new r({id:n,element:m,options:e},...o),f.instance._options=e}let y=e=>{"function"==typeof e||e instanceof Array?(e=t.parse(...e)).then(e=>{"string"==typeof e?m.html(e):m.html("").append(e),!f.instance.rendered||f.instance.rendered({params:i,element:m})}):("string"==typeof e||e instanceof HTMLElement)&&("string"==typeof e?m.html(e):m.html("").append(e),!f.instance.rendered||f.instance.rendered({params:i,element:m}))};if(c===e.types.class){let e=f.instance.render({params:i,element:m});return("function"==typeof e||e instanceof Array)&&(e="function"==typeof e?t.parse(e):t.parse(...e)),e instanceof Promise?e.then(e=>(y(e),p({data:f,element:m}))):(y(e),p({data:f,element:m}))}return p({data:f,element:m})})}));