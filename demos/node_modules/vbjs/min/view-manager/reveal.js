define(["sys/view-manager/utils","sys/app"],(e,t)=>({id:n="",view:a=(()=>{throw a})(),params:i={},uri:s="",elementOrId:r=(()=>{throw r})()})=>new Promise(l=>{let p,o;if("string"==typeof a?(p=a,o=[a]):"object"==typeof a&&(p=a.name,o=a.inject?[p].concat(a.inject):[p]),!p||!o)throw new Error("View definition incorrect!");require(o,(a,...o)=>{let m=s.hashCode(),d=e.getViewType(a,p),c="string"==typeof r?"span".createElement(r):r,f={type:d,uriHash:m,x:0,y:0,id:n};if(n&&(c.dataset.id=n),d===e.types.string)f.element=c.html(a);else if(d===e.types.template){f.instance=a;let t=a(i,{injected:o});"string"==typeof t?(c.html(t),e.templateRendered(i,c)):t instanceof HTMLElement?(c.html("").append(t),e.templateRendered(i,c)):t instanceof Promise&&t.then(t=>{"string"==typeof t?c.html(t):c.html("").append(t),e.templateRendered(i,c)})}else if(d===e.types.class){let e={disableCaching:!1,callRenderOnlyOnce:!1};f.instance=new a({id:n,element:c,options:e},...o),f.instance._options=e}let y=n=>{"function"==typeof n||n instanceof Array?(n=t.parse(...n)).then(t=>{"string"==typeof t?c.html(t):c.html("").append(t),e.moduleRendered(f.instance,{params:i,element:c})}):("string"==typeof n||n instanceof HTMLElement)&&("string"==typeof n?c.html(n):c.html("").append(n),e.moduleRendered(f.instance,{params:i,element:c}))};if(d===e.types.class){let e=f.instance.render({params:i,element:c});return("function"==typeof e||e instanceof Array)&&(e="function"==typeof e?t.parse(e):t.parse(...e)),e instanceof Promise?e.then(e=>(y(e),l({data:f,element:c}))):(y(e),l({data:f,element:c}))}return l({data:f,element:c})})}));