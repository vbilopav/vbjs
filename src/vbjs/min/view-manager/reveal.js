define(["sys/view-manager/utils"],e=>({id:t="",view:n=(()=>{throw n})(),params:i={},uri:r="",elementOrId:s=(()=>{throw s})()})=>new Promise(a=>{const o=window[requirejs.s.contexts._.config.__appObjName];let p,l;if("string"==typeof n?(p=n,l=[n]):"object"==typeof n&&(p=n.name,l=n.inject?[p].concat(n.inject):[p]),!p||!l)throw new Error("View definition incorrect!");require(l,(n,...l)=>{let d=r.hashCode(),c=e.getViewType(n,p),m="string"==typeof s?"span".createElement(s):s,f={type:c,uriHash:d,x:0,y:0,id:t};if(t&&(m.dataset.id=t),c===e.types.string)f.element=m.html(n);else if(c===e.types.template){f.instance=n;let e=n(i,{injected:l});"string"==typeof e?(m.html(e),i.___rendered(m)):e instanceof HTMLElement?(m.html("").append(e),i.___rendered(m)):e instanceof Promise&&e.then(e=>{"string"==typeof e?m.html(e):m.html("").append(e),i.___rendered(m)})}else if(c===e.types.class){let e={disableCaching:!1,callRenderOnlyOnce:!1};f.instance=new n({id:t,element:m,options:e},...l),f.instance._options=e}let y=e=>{"function"==typeof e||e instanceof Array?(e=o.parse(...e)).then(e=>{"string"==typeof e?m.html(e):m.html("").append(e),!f.instance.rendered||f.instance.rendered({params:i,element:m})}):("string"==typeof e||e instanceof HTMLElement)&&("string"==typeof e?m.html(e):m.html("").append(e),!f.instance.rendered||f.instance.rendered({params:i,element:m}))};if(c===e.types.class){let e=f.instance.render({params:i,element:m});return("function"==typeof e||e instanceof Array)&&(e="function"==typeof e?o.parse(e):o.parse(...e)),e instanceof Promise?e.then(e=>(y(e),a({data:f,element:m}))):(y(e),a({data:f,element:m}))}return a({data:f,element:m})})}));