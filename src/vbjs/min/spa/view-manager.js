define(["sys/view-manager/utils","sys/view-manager/reveal"],(e,n)=>(class{constructor(e=(()=>{throw e})()){this._container=e,this._views={},this._current}leave(e){if(void 0===e)return this;let n=this._views[e];return n?(n.x=window.pageXOffset,n.y=window.pageYOffset,this):this}async reveal({id:t="",view:i=(()=>{throw i})(),params:s={},uri:a=""}){s=await e.prepareParams(s);let r=window[requirejs.s.contexts._.config.__appObjName];await new Promise((h,c)=>{let o=this._views[t],d=a.hashCode(),p=e.getId(d);if(this._current&&this._current.hide(),o){if(o.type===e.types.string)return this._current=o.element.show(),e.showView(o,o.element),h(o.element.id);let n=this._container.find("#"+p);if(o.type===e.types.template){if(n.length||(n="span".createElement(p).appendTo(this._container)),o.uriHash!==d){let e=o.instance(s);"string"==typeof e?(n.html(e),s.___rendered(n)):e instanceof HTMLElement?(n.html("").append(e),s.___rendered(n)):e instanceof Promise&&e.then(e=>{"string"==typeof e?n.html(e):n.html("").append(e),s.___rendered(n)})}return this._current=n.show(),e.showView(o,n),h(n.id)}if(n.length||(n=this._container.find("[data-id='"+t+"']")).length&&(n.id=p),n.length||(n="span".createElement(p).appendTo(this._container)),o.type===e.types.class){let t=()=>{this._current=n.show(),e.showView(o,n),o.uriHash=d};if(o.uriHash!==d||o.instance._options.disableCaching){let e;o.instance.change?e=o.instance.change({params:s,element:n}):o.instance._options.callRenderOnlyOnce||(e=o.instance.render({params:s,element:n}));let i=e=>{"function"==typeof e||e instanceof Array?(e=r.parse(...e)).then(e=>{"string"==typeof e?n.html(e).show():n.html("").append(e).show(),o.instance.changed?o.instance.changed({params:s,element:n}):o.instance.rendered&&o.instance.rendered({params:s,element:n}),t()}):("string"==typeof e||e instanceof HTMLElement)&&("string"==typeof e?n.html(e).show():n.html("").append(e).show(),o.instance.changed?o.instance.changed({params:s,element:n}):o.instance.rendered&&o.instance.rendered({params:s,element:n}),t())};return"function"==typeof e&&(e=r.parse(e)),e instanceof Array&&(e=r.parse(...e)),e instanceof Promise?e.then(e=>(i(e),h(n.id))):(i(e),h(n.id))}return t(),h(n.id)}return c("unknown type")}n({id:t,view:i,params:s,uri:a,elementOrId:p}).then(n=>(this._views[t]=n.data,this._container.append(n.element),this._current=n.element,e.showView(n.data,n.element),h(n.element.id)))})}}));