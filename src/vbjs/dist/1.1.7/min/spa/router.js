define([],()=>(class{constructor({navigate:e=(()=>{}),leave:t=(()=>{}),error:a=(()=>{}),hash:h="#",test:r=(e=>/^[ A-Za-z0-9_@()/.-]*$/.test(e)),routes:s=(()=>{throw s})()}){this._navigate=e,this._leave=t,this._error=a,this._hash=h,"#"===this._hash||"#!"===this._hash||(()=>{throw this._hash})(),this._test=r,s instanceof Array&&(s=s.reduce(function(e,t,a){return e[t]={},e},{})),this._routes={};for(let e in s){let t=s[e];this._test(e)||(()=>{throw e})(),this._routes[e]={id:t.id||e.replace(/\//g,"-").replace("-","").toCamelCase(),name:e,view:t.view,paramsMap:t.paramsMap||(e=>0===e.length&&{}),data:t.data}}this._current=void 0,this._manager={reveal:({id:e,view:t,params:a,uri:h})=>new Promise(e=>e()),leave:(e,t)=>this._manager}}useViewManager(e=(()=>{throw e})()){return this._manager=e,this}start(){this._onChangeEvent(void 0,!0);var e=this;return window.on("hashchange",t=>{e._onChangeEvent.call(e,t)}),this}getData(){return Object.keys(this._routes).map(e=>{let t=this._routes[e],a=t.data||{};return a.url=document.location.pathname+this._hash+e,a.id=t.id,a.active=this._current===t,a})}navigate(e){return document.location.hash=this._hash+e,this}reveal(e){return this._onChangeEvent({newHash:this._hash+e}),this}_onChangeEvent(e={newHash:document.location.hash},t=!1){!e.newHash&&e.newURL&&(e.newHash=e.newURL.replace(document.location.origin+document.location.pathname,""));let a,h,r,s,i,n,o,u,_=e.newHash.replace(this._hash,""),l=_.split("/").map(e=>decodeURIComponent(e)),c="";for(s=0,i=l.length;s<i;s++){let e=l[s];c=c.endsWith("/")?c+e:c+"/"+e,((h=this._routes[c])&&!a||h&&a.name.length<h.name.length)&&(a=h,n=s+1)}a&&(""==l[l.length-1]&&l.splice(-1,1),r=a.paramsMap(l.slice(n))),void 0!==a&&r?(this._current&&(o=this._current.id,u=this._current.elementId),this._manager.leave(o,u).reveal({id:a.id,view:a.view,params:r,uri:_}).then(e=>{t||this._leave({router:this,route:this._current}),this._current=a,this._current.elementId=e,this._navigate({router:this,route:a,params:r})})):this._error({router:this,uri:_})}}));